<app-section-container [isExpanded]="false">
  <div class="part">
    <h2>
      <span>Convert RVA and VA to a file offset</span>
    </h2>
    <p>
      Convert a <em>RVA</em> to a file offset:
    </p>
    <ul>
      <li>
        <span class="mono-font">0x</span><input type="text" (input)="onRva($event.target.value)" />
      </li>
      <li>
        <span class="mono-font">-</span>&nbsp;<span class="data-directories cli-header-directory-rva mono-font">{{pe.textSectionItem.baseRva.rva | hex}}</span>
        (.text section base RVA)
      </li>
      <li>
        <span class="mono-font">+</span>&nbsp;<span class="text-section-header text-file-offset mono-font">{{pe.textSectionItem.fileOffset.fileOffset | hex}}</span>
        (.text section file offset)
      </li>
      <li>
        <span class="mono-font">=</span>&nbsp;<span class="mono-font">{{fileOffsetFromRvaDec | byte | leftpad:8}}</span>
      </li>
    </ul>
    <p>
      Convert a <em>VA</em> to a file offset:
    </p>
    <ul>
      <li>
        <span class="mono-font">0x</span><input type="text" (input)="onVa($event.target.value)" />
      </li>
      <li>
        <span class="mono-font">-</span>&nbsp;<span class="mono-font nt-specific-fields image-base">{{pe.imageBase.hexValue | hex}}</span>
        (image base VA)
      </li>
      <li>
        <span class="mono-font">-</span>&nbsp;<span class="data-directories cli-header-directory-rva mono-font">{{pe.textSectionItem.baseRva.rva | hex}}</span>
        (.text section base RVA)
      </li>
      <li>
        <span class="mono-font">+</span>&nbsp;<span class="text-section-header text-file-offset mono-font">{{pe.textSectionItem.fileOffset.fileOffset | hex}}</span>
        (.text section file offset)
      </li>
      <li>
        <span class="mono-font">=</span>&nbsp;<span class="mono-font">{{fileOffsetFromVaDec | byte | leftpad:8}}</span>
      </li>
    </ul>
  </div>
</app-section-container>
<app-section-container>
  <div *ngIf="pe.importAddressTable" class="part">
    <h2>
      <span class="import-address-table">Import address table ({{pe.importAddressTableSizeDec}} bytes)</span>
    </h2>
    <p>From
      <span class="mono-font">{{pe.importAddressTable.startOffsetDec | byte | leftpad:8}}</span> to
      <span class="mono-font">{{pe.importAddressTable.endOffsetDec | byte | leftpad:8}}</span>
    </p>
    <p>
      The start offset is converted from base RVA
      <span class="data-directories import-address-table-directory-rva mono-font">{{pe.importAddressTableDirectory.rva.rva | hex}}</span>
      from the import address table of the <span class="data-directories">data directories</span>.
    </p>
    <p>
      The <span class="import-address-table iat-entry-point-rva">import address table entry point RVA</span> is located at file offset
      <span class="mono-font">{{pe.iatEntryPointRva.startOffsetDec | byte | leftpad:8}}</span> which was converted from base RVA
      <span class="entry-point entry-point-va mono-font">{{pe.entryPointVa.va | hex}}</span>
      from the <span class="entry-point">entry point</span>. The
      <span class="import-address-table iat-entry-point-rva">import address table entry point RVA</span> has for value
      <span class="import-address-table iat-entry-point-rva mono-font">{{pe.iatEntryPointRva.rva | hex}}</span>.
    </p>
  </div>
  <div *ngIf="!pe.importAddressTable" class="part">
    <h2>
      <span class="import-address-table">Import address table ({{pe.importAddressTableSizeDec}} bytes)</span>
    </h2>
    <p>
      There is no import address table
    </p>
  </div>
</app-section-container>
<app-section-container>
  <div class="part">
    <h2>
      <span class="cli-header">CLI header (always {{pe.cliHeaderSizeDec}} bytes)</span>
    </h2>
    <p>From
      <span class="mono-font">{{pe.cliHeader.startOffsetDec | byte | leftpad:8}}</span> to
      <span class="mono-font">{{pe.cliHeader.endOffsetDec | byte | leftpad:8}}</span>
    </p>
    <p>
      The start offset is converted from base RVA
      <span class="data-directories cli-header-directory-rva mono-font">{{pe.cliHeaderDirectory.rva.rva | hex}}</span>
      from the import address table of the <span class="data-directories">data directories</span>.
    </p>
    <p>
        The CLI metadata header (8 bytes) is located at offset {{peConstants.cliMetadataHeaderDirectorySubOffsetDec}} of the
        <span class="cli-header">CLI header</span>. It points to a header of
        <span class="cli-header cli-metadata-header-directory-size mono-font">{{pe.cliMetadataHeaderDirectory.size.hexValue | hex}}</span>
        bytes.
        Using the convertor above we get the file offset <span class="mono-font">{{pe.cliMetadataHeader.startOffsetDec | byte | leftpad:8}}</span>
        based on the base RVA
        <span class="cli-header cli-metadata-header-directory-rva mono-font">{{pe.cliMetadataHeaderDirectory.rva.rva | hex}}</span>.
    </p>
    <p>The <span class="cli-header cli-flags">CLI flags</span> ({{peConstants.cliFlagsSizeDec}} bytes) are located at offset
      {{peConstants.cliFlagsSubOffsetDec}} of the <span class="cli-header">CLI header</span> and have a value of
      <span class="mono-font cli-header cli-flags">{{pe.cliFlags.hexValue | hex}}</span>. The <span class="cli-header cli-flags">CLI flags</span>
      are leveraging <app-link [href]="'https://en.wikipedia.org/wiki/Mask_(computing)'">bitmask</app-link>:
    </p>
    <ul>
      <li><span class="mono-font">ILOnly&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x00001</span>: <em>{{pe.cliFlags.ILOnly}}</em>
        ({{pe.cliFlags.ILOnly ? 'contains only managed code' : 'contains managed and native code'}})
      </li>
      <li><span class="mono-font">Requires32Bit&nbsp;&nbsp;&nbsp; 0x00002</span>: <em>{{pe.cliFlags.Requires32Bit}}</em>
        (<app-link [href]="'http://blogs.microsoft.co.il/sasha/2012/04/04/what-anycpu-really-means-as-of-net-45-and-visual-studio-11/'">requires</app-link>
        32-bit when compiled in AnyCPU)</li>
      <li><span class="mono-font">ILLibrary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x00004</span>: <em>{{pe.cliFlags.ILLibrary}}</em></li>
      <li><span class="mono-font">StrongNameSigned 0x00008</span>: <em>{{pe.cliFlags.StrongNameSigned}}</em>
        (see <app-link [href]="'https://docs.microsoft.com/en-us/dotnet/framework/app-domains/strong-named-assemblies'">strong named</app-link>)
      </li>
      <li><span class="mono-font">NativeEntryPoint 0x00010</span>: <em>{{pe.cliFlags.NativeEntryPoint}}</em></li>
      <li><span class="mono-font">TrackDebugData&nbsp;&nbsp; 0x10000</span>: <em>{{pe.cliFlags.TrackDebugData}}</em></li>
      <li><span class="mono-font">Prefers32Bit&nbsp;&nbsp;&nbsp;&nbsp; 0x20000</span>: <em>{{pe.cliFlags.Prefers32Bit}}</em>
        (<app-link [href]="'http://blogs.microsoft.co.il/sasha/2012/04/04/what-anycpu-really-means-as-of-net-45-and-visual-studio-11/'">prefers</app-link>
        32-bit when compiled in AnyCPU)</li>
    </ul>
  </div>
</app-section-container>
<app-section-container>
  <div class="part">
    <h2>
      <span class="cli-metadata-header">CLI metadata header ({{pe.cliMetadataHeader.sizeDec}} bytes)</span>
    </h2>
    <p>From
      <span class="mono-font">{{pe.cliMetadataHeader.startOffsetDec | byte | leftpad:8}}</span> to
      <span class="mono-font">{{pe.cliMetadataHeader.endOffsetDec | byte | leftpad:8}}</span>
    </p>
    <p>The <span class="cli-metadata-header clr-version-size">CLR version size</span> ({{peConstants.clrVersionSizeSizeDec}} bytes) is located at offset
      {{peConstants.clrVersionSizeSubOffsetDec}} of the <span class="cli-metadata-header">CLI metadata header</span> and has a value of
      <span class="mono-font cli-metadata-header clr-version-size">{{pe.clrVersionSize.hexValue | hex}} bytes</span>. The targeted
      <span class="cli-metadata-header clr-version">CLR version</span> is encoded using <em>ASCII</em> characters and has for value
      <span class="mono-font cli-metadata-header clr-version">{{pe.clrVersion.text}}</span>.
    </p>
  </div>
</app-section-container>
<app-section-container>
  <div *ngIf="pe.importTable" class="part">
    <h2>
      <span class="import-table">Import table ({{pe.importTableSizeDec}} bytes)</span>
    </h2>
    <p>From
      <span class="mono-font">{{pe.importTable.startOffsetDec | byte | leftpad:8}}</span> to
      <span class="mono-font">{{pe.importTable.endOffsetDec | byte | leftpad:8}}</span>
    </p>
    <p>
      The start offset is converted from base RVA
      <span class="data-directories import-table-directory-rva mono-font">{{pe.importTableDirectory.rva.rva | hex}}</span>
      from the import address table of the <span class="data-directories">data directories</span>.
    </p>
    <p>
      The <em>managed entry point</em> starts a file offset <span class="mono-font">{{pe.managedEntryPoint.method.startOffsetDec | byte | leftpad:8}}</span>
      This was converted from the <span class="import-address-table iat-entry-point-rva">import address table entry point RVA</span>
      (<span class="import-address-table iat-entry-point-rva mono-font">{{pe.iatEntryPointRva.rva | hex}}</span>)
    </p>
    <ul>
      <li>
        Function: <span class="import-table entry-point-method mono-font">{{pe.managedEntryPoint.method.text}}</span>
      </li>
      <li>
        Executable: <span class="import-table entry-point-executable mono-font">{{pe.managedEntryPoint.executable.text}}</span>
      </li>
    </ul>
  </div>
  <div *ngIf="!pe.importTable" class="part">
    <h2>
      <span class="import-table">Import table (0 bytes)</span>
    </h2>
    <p>
      There is no import table
    </p>
  </div>
</app-section-container>
<app-section-container>
  <div *ngIf="pe.entryPoint" class="part">
    <h2>
      <span class="entry-point">Entry point ({{peConstants.entryPointSizeDec}} bytes)</span>
    </h2>
    <p>From
      <span class="mono-font">{{pe.entryPoint.startOffsetDec | byte | leftpad:8}}</span> to
      <span class="mono-font">{{pe.entryPoint.endOffsetDec | byte | leftpad:8}}</span>
    </p>
    <p>
      The start offset is converted from the RVA
      <span class="standard-fields address-entry-point">address of entry point</span>:
      <span class="mono-font standard-fields address-entry-point">{{pe.addressOfEntryPoint.rva | hex}}</span>.
    </p>
    <p>
      Apparently <span class="mono-font entry-point entry-point-op-code">{{pe.entryPointOpCode.hexValue}}</span> is the
      <app-link [href]="'https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x86-instructions#control_flow'">x86 instruction</app-link>
      for <span class="mono-font">JMP</span> which instruct the computer to jump to file offset <span class="mono-font">{{pe.iatEntryPointRva.startOffsetDec | byte | leftpad:8}}</span>
      (converted from VA <span class="mono-font entry-point entry-point-va">{{pe.entryPointVa.va | hex}}</span>)
    </p>
  </div>
  <div *ngIf="!pe.entryPoint" class="part">
    <h2>
      <span class="entry-point">Entry point (0 bytes)</span>
    </h2>
    <p>
      There is no entry point
    </p>
  </div>
</app-section-container>
